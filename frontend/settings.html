<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Johka ‚Äì Instellingen</title>
  <style>
    :root {
      --accent:#ff3c7d;
      --bg-dark:#0a0a0a;
      --bg-panel:#151515;
      --muted:#888;
      --gold:#f8d66d;
    }
    body{
      background:var(--bg-dark);
      color:#fff;
      font-family:"Segoe UI",sans-serif;
      margin:0;
    }
    nav{
      background:var(--bg-panel);
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 20px;
      border-bottom:1px solid #222;
    }
    #logo{font-size:20px;font-weight:bold;color:var(--accent);}
    #navLinks a{
      color:#ddd;
      text-decoration:none;
      margin-left:16px;
    }
    #navLinks a:hover{color:#fff;}
    #logoutBtn{
      background:#333;
      border:none;
      border-radius:6px;
      color:#fff;
      padding:6px 12px;
      cursor:pointer;
      font-weight:bold;
      margin-left:10px;
    }
    #logoutBtn:hover{background:var(--accent);}

    main{
      flex:1;
      max-width:800px;
      margin:40px auto;
      background:var(--bg-panel);
      padding:20px;
      border-radius:12px;
      box-shadow:0 0 15px rgba(0,0,0,0.4);
    }

    h2{color:var(--accent);margin-top:0;}

    form{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    label{font-size:14px;color:var(--muted);}
    input,textarea{
      background:#1b1b1b;
      border:1px solid #333;
      border-radius:8px;
      padding:8px;
      color:#fff;
      font-size:14px;
      resize:vertical;
    }

    button{
      background:var(--accent);
      border:none;
      color:#fff;
      padding:10px 14px;
      border-radius:8px;
      font-weight:bold;
      cursor:pointer;
      width:fit-content;
    }
    button:hover{opacity:0.9;}

    #avatarPreview{
      width:120px;
      height:120px;
      border-radius:50%;
      object-fit:cover;
      border:2px solid var(--accent);
    }

    .gallery{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .gallery img{
      width:120px;
      height:120px;
      object-fit:cover;
      border-radius:8px;
      border:1px solid #333;
    }

    footer{
      text-align:center;
      padding:8px;
      font-size:12px;
      color:var(--muted);
      background:#0a0a0a;
      border-top:1px solid #111;
    }
    /* üåê Modernere stijl voor instellingen */
.settings-panel {
  background: #fff;
  color: #222;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  padding: 30px;
  max-width: 900px;
  margin: 40px auto;
}

.settings-panel h2 {
  color: #ff7a00;
  margin-bottom: 20px;
  border-bottom: 1px solid #eee;
  padding-bottom: 10px;
}

.profile-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.form-grid .full {
  grid-column: 1 / -1;
}

.profile-form label {
  font-weight: 600;
  color: #444;
}

.profile-form input,
.profile-form textarea {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  background: #fafafa;
  color: #000;
}

.profile-form button {
  background: #ff7a00;
  color: #fff;
  font-weight: bold;
  border: none;
  border-radius: 6px;
  padding: 10px 20px;
  cursor: pointer;
  width: fit-content;
}

.profile-form button:hover {
  background: #e26d00;
}

/* üì∏ Media upload */
.media {
  margin-top: 40px;
}

.media h3 {
  color: #ff7a00;
  margin-top: 30px;
}

.avatar {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  border: 3px solid #ff7a00;
  object-fit: cover;
  margin-bottom: 10px;
}

.gallery img {
  border: 2px solid #eee;
  border-radius: 6px;
}

.muted {
  color: #888;
  font-size: 13px;
}
/* üå§Ô∏è Volledige pagina wit en scrollbaar */
body {
  background: #f9f9f9 !important;
  color: #222;
  overflow-y: auto !important;
  height: auto !important;
}

/* hoofdcontainer netjes gecentreerd, niet vast in hoogte */
main.settings-panel {
  background: #fff;
  color: #222;
  max-width: 950px;
  margin: 50px auto;
  padding: 30px 40px;
  border-radius: 10px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.1);
  height: auto !important;
  overflow: visible !important;
}

/* voorkom dat iets anders scrollt binnen zijn eigen frame */
html, body, main {
  height: auto !important;
  overflow: visible !important;
}
/* üßπ Verberg de globale navigatiebalk op de settingspagina */
nav.navbar,
header,
#topbar {
  display: none !important;
}

/* Zorg dat de pagina netjes naar boven schuift */
body {
  padding-top: 0 !important;
  margin-top: 0 !important;
}
/* üåê Maak settings-paneel volledig scrollbaar met de hoofdsite */
html, body {
  height: auto !important;
  overflow-y: visible !important;
  overflow-x: hidden;
  background: #f9f9f9;
}

/* Zorg dat het hoofdvenster niet z‚Äôn eigen scroll heeft */
main.settings-panel {
  height: auto !important;
  overflow: visible !important;
  position: relative;
}

/* Verwijder eventueel scroll uit tussenliggende containers */
.container,
.wrapper,
#content,
section {
  height: auto !important;
  overflow: visible !important;
}
/* üö´ Schakel flex en vaste hoogte uit */
html, body {
  display: block !important;
  height: auto !important;
  min-height: 0 !important;
  overflow-y: visible !important;
  overflow-x: hidden !important;
  background: #f9f9f9 !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* ‚úÖ Laat het hoofdgedeelte vrij meeschuiven met de pagina */
main,
main.settings-panel {
  display: block !important;
  position: relative !important;
  height: auto !important;
  min-height: unset !important;
  overflow: visible !important;
  flex: none !important;
  box-sizing: border-box;
}

/* üßπ Schakel oude flexcontainers uit die nog scroll veroorzaken */
body > * {
  flex: none !important;
}
/* üß© LAATSTE FIX ‚Äì alle interne scrolls uitschakelen */
html, body {
  display: block !important;
  height: auto !important;
  min-height: 0 !important;
  overflow-y: visible !important;
  overflow-x: hidden !important;
  background: #f9f9f9 !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* verwijder alle flex- of grid-layout op body */
body {
  display: block !important;
  flex: none !important;
}

/* zorg dat het hoofdgedeelte gewoon met body meescrolt */
main,
main.settings-panel {
  display: block !important;
  height: auto !important;
  min-height: auto !important;
  max-height: none !important;
  overflow: visible !important;
  flex: none !important;
  position: static !important;
  box-sizing: border-box !important;
}

/* verwijder ook scroll uit directe wrappers */
.container,
.wrapper,
#content,
section,
div {
  overflow: visible !important;
  height: auto !important;
  max-height: none !important;
}

  </style>

  <script>
    const API = "https://api.johka.be/api";

    async function loadProfile(){
      const token = localStorage.getItem("token");
      if(!token) return location.href="/login.html";
      const res = await fetch(API + "/me", {
        headers:{Authorization:"Bearer "+token}
      });
      if(res.status === 401){
        return logout();
      }
      if(!res.ok){
        alert("‚ùå Kon profielgegevens niet laden.");
        return;
      }
      const u = await res.json();
      document.getElementById("username").value = u.username;
      document.getElementById("email").value = u.email;
      document.getElementById("bio").value = u.bio || "";
      if (u.username) {
        localStorage.setItem("username", u.username);
      }
      const roomInfo = document.getElementById("roomSlugInfo");
      if(roomInfo){
        if(u.room_slug){
          const roomUrl = `https://johka.be/room/${u.room_slug}`;
          roomInfo.innerHTML = "üì° Jouw kamer is bereikbaar via <a href=\"" +
            roomUrl +
            "\" target=\"_blank\" rel=\"noopener\">" +
            roomUrl +
            "</a>";
        }else{
          roomInfo.textContent = "Er is nog geen kamer gekoppeld aan je account.";
        }
      }
    }

    async function saveProfile(e){
      e.preventDefault();
      const token = localStorage.getItem("token");
      const body = {
        username: document.getElementById("username").value.trim(),
        email: document.getElementById("email").value.trim(),
        bio: document.getElementById("bio").value.trim()
      };
      const password = document.getElementById("password").value.trim();
      if(password){
        body.password = password;
      }
      const res = await fetch(API + "/me/update", {
        method:"POST",
        headers:{
          "Authorization":"Bearer "+token,
          "Content-Type":"application/json"
        },
        body: JSON.stringify(body)
      });
      if(res.status === 401){
        logout();
        return;
      }
      if(res.ok){
        let updatedUsername = body.username;
        try {
          const data = await res.json();
          if (data && data.username) {
            updatedUsername = data.username;
          }
        } catch (_) {
          // Geen JSON of lege body teruggekregen ‚Äì negeer fout.
        }

        

        if (updatedUsername) {
          localStorage.setItem("username", updatedUsername);
        }

        alert("‚úÖ Profiel opgeslagen!");
        document.getElementById("password").value = "";
        const redirectUsername = updatedUsername || localStorage.getItem("username") || body.username;
        if (redirectUsername) {
          window.location.href = `/creatorpage.html?u=${encodeURIComponent(redirectUsername)}`;
        } else {
          window.location.href = "/creatorpage.html";
        }
        if (updatedUsername) {
          window.location.href = `/creatorpage.html?u=${encodeURIComponent(updatedUsername)}`;
        } else {
          window.location.href = "/creatorpage.html";
        }
        window.location.href = "/creatorpage.html";
      }else{
        alert("‚ùå Fout bij opslaan");
      }
    }

    async function uploadAvatar(){
      const token = localStorage.getItem("token");
      const file = document.getElementById("avatar").files[0];
      if(!file) return alert("Kies een afbeelding");
      const form = new FormData();
      form.append("file", file);
      const res = await fetch(API + "/me/avatar", {
        method:"POST",
        headers:{Authorization:"Bearer "+token},
        body:form
      });
      if(res.ok){
        const d = await res.json();
        document.getElementById("avatarPreview").src = d.url;
      }else alert("Upload mislukt");
    }

    async function uploadGallery(){
      const token = localStorage.getItem("token");
      const files = document.getElementById("gallery").files;
      if(!files.length) return alert("Geen foto's geselecteerd");
      for(const f of files){
        const form = new FormData();
        form.append("file", f);
        const r = await fetch(API + "/me/gallery", {
          method:"POST",
          headers:{Authorization:"Bearer "+token},
          body: form
        });
        if(r.ok){
          const d = await r.json();
          const img = document.createElement("img");
          img.src = d.url;
          document.querySelector(".gallery").appendChild(img);
        }
      }
    }

    function logout(){
      localStorage.clear();
      location.href="/login.html";
    }

    window.addEventListener("DOMContentLoaded", ()=>{
      loadProfile();
      document.getElementById("profileForm").addEventListener("submit", saveProfile);
      document.getElementById("uploadAvatarBtn").addEventListener("click", uploadAvatar);
      document.getElementById("uploadGalleryBtn").addEventListener("click", uploadGallery);
      document.getElementById("logoutBtn").addEventListener("click", logout);
    });
  </script>
</head>
<body>
  

 <main class="settings-panel">
  <h2>üë§ Profielinstellingen</h2>

  <form id="profileForm" class="profile-form">
    <div class="form-grid">
      <div>
        <label>Display Name</label>
        <input type="text" id="username" required>
      </div>

      <div>
        <label>E-mail</label>
        <input type="email" id="email" required>
      </div>

      <div>
        <label>Nieuw wachtwoord</label>
        <input type="password" id="password" placeholder="Leeg laten om niet te wijzigen">
      </div>

      <div>
        <label>Locatie</label>
        <input type="text" id="location" placeholder="Bijv. Antwerpen">
      </div>

      <div class="full">
        <label>Bio / Over mij</label>
        <textarea id="bio" rows="4" placeholder="Vertel iets over jezelf, wat maakt jouw stream uniek..."></textarea>
      </div>

      <div class="full">
        <p id="roomSlugInfo" class="muted"></p>
      </div>
    </div>

    <button type="submit" id="saveBtn">üíæ Opslaan</button>
  </form>

  <section class="media">
    <h3>üì∏ Profielfoto</h3>
    <img id="avatarPreview" src="/default-avatar.png" alt="avatar" class="avatar">
    <input type="file" id="avatar" accept="image/*">
    <button id="uploadAvatarBtn">Uploaden</button>

    <h3>üñºÔ∏è Galerij / Promofoto's</h3>
    <input type="file" id="gallery" accept="image/*" multiple>
    <button id="uploadGalleryBtn">Uploaden</button>
    <div class="gallery"></div>
  </section>
</main>


  
</body>
</html>
