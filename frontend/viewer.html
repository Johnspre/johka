<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Johka Live â€“ Bekijk stream</title>
 
  <link rel="stylesheet" href="/css/style-viewer.css">

</head>
<body>
  <!-- ğŸ” TOP BAR -->
<header class="topbar">
  <div class="nav-left">
    <div class="logo">Johka Live ğŸ”¥</div>
    <nav>
      <a href="/index.html">Home</a>
      <a href="#">Discover</a>
      <a href="#">Tags</a>
      <a href="#">Private Shows</a>
      <a href="#">Following</a>
      <a href="#">Merch</a>
    </nav>
  </div>

  <div class="nav-right">
    <div class="profile-menu" id="profileMenu">
      <button id="profileBtn">ğŸ‘¤ Gebruiker â–¾</button>
      <div class="dropdown" id="profileDropdown">
        <div class="dropdown-content"></div>
      </div>
    </div>

    <button id="broadcastBtn">Broadcast Yourself</button>
    <button id="signupBtn" onclick="location.href='/register.html'">
      Sign Up â–¶
    </button>
  </div>
</header>


  <main class="viewer-layout">
  <section id="viewer-left">
    <div id="player">
      <video id="remoteVideo" autoplay playsinline></video>
      <div id="playerOverlay">Verbinden â€“ wachten op videoâ€¦</div>
    </div>

  </section>

  <!-- ğŸ¬ VIEWER RECHTERKOLOM -->
<aside id="viewer-right" class="side-panel">

  <!-- ğŸ”´ STREAM STATUS -->
  <div id="streamStatusBox" class="stream-status">
    <div id="statusBadge" class="offline">
      <span>â—</span><span id="statusText">Offline</span>
    </div>
    <div id="creatorName">Onbekend</div>
    <div id="viewerCount">ğŸ‘ 0 kijkers</div>
  </div>

  <!-- ğŸ”¸ Tabs -->
  <div class="tab-bar">
    <button class="tab active" data-tab="chat">ğŸ’¬ Chat</button>
    <button class="tab" data-tab="pm">ğŸ’Œ PM</button>
    <button class="tab" data-tab="users">ğŸ‘¥ Users</button>
    <button class="tab" data-tab="settings">âš™ï¸ Instellingen</button>
  </div>

  <!-- ğŸ’¬ CHAT TAB -->
  <div id="chatTab" class="tab-content" style="display:block;">
    <div id="chatBox">
      <div id="messageLog">Verbinden met stream...</div>
    </div>

    <form id="chatForm" class="chat-input-bar">
      <input id="chatInput" type="text" placeholder="Typ een bericht..." autocomplete="off" />
      <button id="viewerEmojiBtn" type="button">ğŸ˜Š</button>
      <button id="chatSendBtn" type="submit">Verstuur</button>
      <div id="emojiPopup" class="hidden"></div>
    </form>

    <div id="chatNotice"></div>

    <!-- ğŸ’¸ Donatiebalk -->
    <div id="donationBar">
      <input id="donateInput" type="number" min="1" step="1" value="10" inputmode="numeric" />
      <button id="donateBtn">ğŸ’¸ Tip</button>
    </div>

    <button id="leaveBtn" class="leave-btn">ğŸšª Verlaat kamer</button>
  </div>

  <!-- ğŸ’Œ PRIVÃ‰ TAB -->
  <div id="pmTab" class="tab-content">
    <p>PrivÃ©berichten of sessies komen hierâ€¦</p>
  </div>

  <!-- ğŸ‘¥ USERS TAB -->
  <div id="usersTab" class="tab-content">
    <ul id="userList"></ul>
    <p id="anonCount">+0 anonymous users</p>
  </div>

  <!-- âš™ï¸ INSTELLINGEN TAB -->
  <div id="settingsTab" class="tab-content">
    <h4>âš™ï¸ Instellingen</h4>
    <label>Fontgrootte:
      <select>
        <option>9 pt</option>
        <option>10 pt</option>
        <option>11 pt</option>
      </select>
    </label>
    <br />
    <label><input type="checkbox" checked /> Toon emoticons</label>
  </div>

</aside>
  <!-- Creator info / bio panel zoals Chaturbate -->
  <section id="creatorInfoBox">
    <div id="creatorTabs">
      <button class="active" data-tab="bio">Bio</button>
      <button data-tab="pics">Pics & Videos</button>
      <button data-tab="more">More Rooms Like This</button>
      <button data-tab="share">Share</button>
    </div>
    <div id="creatorContent">
      <p id="creatorBio">Ladenâ€¦</p>
    </div>
  </section>
</main>

  <footer>Johka Live â€“ powered by LiveKit âš¡</footer>
  <script type="module" src="/js/viewer.js"></script>
  <script src="/js/navbar-auth.js"></script>

<script>
  // ---- eenvoudige roster buffer ----
  const rosterByKey = new Map();

  function trackParticipant(p) {
    rosterByKey.set(p.identity || p.sid, {
      username: p.identity || "Anonymous"
    });
  }

  function updateViewerList() {
    const userList = document.getElementById("userList");
    if (!userList) return;
    userList.innerHTML = "";
    rosterByKey.forEach((entry) => {
      const li = document.createElement("li");
      li.textContent = entry.username;
      userList.appendChild(li);
    });
    const anon = document.getElementById("anonCount");
    if (anon) anon.textContent = "+0 anonymous users";
  }

  function syncRosterFromRoom() {
    const room = window.lkRoom;
    if (!room) return; // nog niet klaar
    rosterByKey.clear();

    if (room.localParticipant) trackParticipant(room.localParticipant);
    if (room.remoteParticipants instanceof Map) {
      room.remoteParticipants.forEach((p) => trackParticipant(p));
    }
    updateViewerList();
  }

  // ---- wacht tot lkRoom bestaat, dan initialiseren ----
  (function waitForRoom(){
    if (window.lkRoom) {
      // init eerste keer
      syncRosterFromRoom();
      // fallback: periodiek verversen
      setInterval(syncRosterFromRoom, 5000);
    } else {
      setTimeout(waitForRoom, 400);
    }
  })();

  // ---- tabs zichtbaar maken + users-tab triggeren ----
  (function initTabs(){
    const tabs = document.querySelectorAll('#streamStatusBox .tab');
    const panels = document.querySelectorAll('.tabContent');
    tabs.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        // active state
        tabs.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        // show/hide panels
        panels.forEach(p=>p.style.display='none');
        const id = (btn.dataset.tab || '') + 'Tab';
        const panel = document.getElementById(id);
        if (panel) panel.style.display = 'block';
        // bij openen van Users-tab: meteen syncen
        if (id === 'usersTab') syncRosterFromRoom();
      });
    });
  })();
</script>

<script>
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none');
    tab.classList.add('active');
    const pane = document.getElementById(tab.dataset.tab + 'Tab');
    if (pane) pane.style.display = 'block';
  });
});
</script>



</body>
</html>