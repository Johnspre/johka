<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Johka Live ‚Äì Bekijk stream</title>
 
 
  <link rel="stylesheet" href="/css/viewer.css">

</head>
<body>
  <!-- üîù TOP BAR -->
<header class="topbar">
  <div class="nav-left">
    <div class="logo">Johka Live üî•</div>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/discover.html">Discover</a>
      <a href="/tags.html">Tags</a>
      <a href="/private.html">Private Shows</a>
      <a href="/following.html">Following</a>
      <a href="/merch.html">Merch</a>
    </nav>
  </div>

  <div class="nav-right">
    <div class="profile-menu" id="profileMenu">
      <button id="profileBtn">üë§ Anonymous ‚ñæ</button>
      <div class="dropdown" id="profileDropdown">
        <div class="dropdown-content"></div>
      </div>
    </div>

    <button id="broadcastBtn">Broadcast Yourself</button>
    <button id="signupBtn" onclick="location.href='/register.html'">
      Sign Up ‚ñ∂
    </button>
  </div>
</header>


  <main class="viewer-layout">
  <section id="viewer-left">
    <div id="player">
      <video id="remoteVideo" autoplay playsinline></video>
      <div id="playerOverlay">Verbinden ‚Äì wachten op video‚Ä¶</div>
    </div>

    <!-- Creator info / bio panel zoals Chaturbate -->
    <div id="creatorInfoBox">
      <div id="creatorTabs">
        <button class="active" data-tab="bio">Bio</button>
        <button data-tab="pics">Pics & Videos</button>
        <button data-tab="more">More Rooms Like This</button>
        <button data-tab="share">Share</button>
      </div>
      <div id="creatorContent">
        <p id="creatorBio">Laden‚Ä¶</p>
      </div>
    </div>
  </section>

  <aside id="viewer-right">
    <div id="streamStatusBox">
      <div id="statusBadge" class="offline"><span>‚óè</span><span id="statusText">Offline</span></div>
      <div id="creatorName">Onbekend</div>
      <div id="viewerCount">üëÅ 0 kijkers</div>
    </div>

    <div id="chatBox">
      <div id="messageLog">Verbinden met stream...</div>
    </div>

    <form id="chatForm" class="chat-input-bar">
      <input id="chatInput" type="text" placeholder="Typ een bericht..." autocomplete="off" />
      <button id="viewerEmojiBtn" type="button">üòä</button>
      <button id="chatSendBtn" type="submit">Verstuur</button>
      <div id="emojiPopup" class="hidden"></div>
    </form>
    <div id="chatNotice"></div>

    <button id="leaveBtn" class="leave-btn">üö™ Verlaat kamer</button>
  </aside>
</main>

  <footer>Johka Live ‚Äì powered by LiveKit ‚ö°</footer>
  <script type="module" src="/js/viewer.js"></script>
  <script>
// Copy logic from index.html
const profileBtn = document.getElementById("profileBtn");
const dropdown = document.getElementById("profileDropdown");
const token = localStorage.getItem("token");
const username = localStorage.getItem("username");

// Dropdown toggle
profileBtn?.addEventListener("click", () =>
  dropdown.classList.toggle("show")
);

window.addEventListener("click", e => {
  if (!e.target.matches("#profileBtn")) dropdown.classList.remove("show");
});

// Check token expiry (same method)
function tokenExpired(token) {
  try {
    const payload = JSON.parse(atob(token.split(".")[1]));
    const now = Math.floor(Date.now() / 1000);
    return payload.exp && payload.exp < now;
  } catch {
    return true;
  }
}

// UI logic
if (token && !tokenExpired(token)) {
  profileBtn.innerText = `üë§ ${username} ‚ñæ`;
  document.querySelector(".dropdown-content").innerHTML = `
    <p><strong>Status:</strong> Basic Member</p>
    <p><strong>Tokens:</strong> 0</p>
    <hr>
    <a href="/profile.html">My Profile</a>
    <a href="/feedback.html">Send Feedback</a>
    <a href="#" onclick="logoutUser(); return false;" style="color:#ff7300;">(Log Out)</a>
  `;
} else {
  profileBtn.innerText = "üë§ Anonymous ‚ñæ";
  document.querySelector(".dropdown-content").innerHTML = `
    <p><strong>Status:</strong> Anonymous</p>
    <p><strong>Tokens:</strong> 0</p>
    <hr>
    <a href="#" onclick="openLoginPopup(); return false;" style="color:#ff7300;">(Log In)</a>
    <a href="/register.html" style="color:#0080c0;">(Sign Up)</a>
  `;
}

// Broadcast button logic
document.getElementById("broadcastBtn")?.addEventListener("click", () => {
  if (!token || tokenExpired(token)) {
    openLoginPopup();
  } else {
    location.href = "/room.html";
  }
});

// Modal functions (re-use from index)
function openLoginPopup() {
  const modal = document.getElementById("loginModal");
  const iframe = modal.querySelector("iframe");
  const dark = document.body.classList.contains("dark");
  iframe.src = `/login.html?dark=${dark}`;
  modal.classList.add("show");
}

function logoutUser() {
  localStorage.removeItem("username");
  localStorage.removeItem("token");
  location.reload();
}
</script>
<div id="loginModal" class="modal">
  <div class="modal-content fade-in">
    <button class="close" onclick="closeLoginPopup()">‚úñ</button>
    <iframe src="" class="login-frame"></iframe>
  </div>
</div>

<script>
function closeLoginPopup() {
  document.getElementById("loginModal").classList.remove("show");
}
</script>

</body>
</html>