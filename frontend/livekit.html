<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Johka LiveKit Test</title>
  <style>
    body { background:#0b1520; color:#ddd; font-family:sans-serif; text-align:center; padding:30px; }
    h1 { color:#33b5ff; }
    button { padding:10px 20px; margin:10px; border:none; border-radius:6px; cursor:pointer; font-size:16px; }
    #log { margin-top:20px; background:#111; padding:15px; border-radius:10px; width:80%; margin-left:auto; margin-right:auto; text-align:left; white-space:pre-line; font-family:monospace; }
    video { width:320px; height:240px; border-radius:8px; margin-top:20px; display:none; }
    .ok { color:#4caf50; } .err { color:#e53935; } .warn { color:#ff9800; }
  </style>
</head>
<body>
  <h1>ğŸ¥ Johka LiveKit Test</h1>
  <p>Gebruik deze tool om te testen of de LiveKit-server bereikbaar is en correct verbinding maakt.</p>
  <button id="getToken">ğŸ”‘ Token ophalen</button>
  <button id="connect">ğŸ”— Verbinden</button>
  <button id="startCam">ğŸ“¸ Camera testen</button>

  <div id="log"></div>
  <video id="preview" autoplay playsinline></video>

  <script type="module">
    import { Room } from "https://cdn.jsdelivr.net/npm/livekit-client@2.0.10/+esm";

    const API = "https://api.johka.be/api/livekit-token-test";
    const WS_URL = "wss://live.johka.be";
    let token = null;
    let room = null;

    const logDiv = document.getElementById("log");
    function log(msg, cls="") {
      const line = document.createElement("div");
      if (cls) line.className = cls;
      line.textContent = msg;
      logDiv.appendChild(line);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(msg);
    }

    document.getElementById("getToken").onclick = async () => {
      log("ğŸ”„ Ophalen van LiveKit-token...");
      try {
        const r = await fetch(API, { method:"POST" });
        const data = await r.json();
        if (!data.token) throw new Error(JSON.stringify(data));
        token = data.token;
        log("âœ… Token ontvangen:\n" + token.substring(0,50) + "...", "ok");
      } catch (e) {
        log("âŒ Token ophalen mislukt: " + e.message, "err");
      }
    };

    document.getElementById("connect").onclick = async () => {
      if (!token) return log("âš ï¸ Geen token â€” klik eerst op 'Token ophalen'", "warn");
      log("ğŸ”— Verbinden met LiveKit...");
      try {
        room = new Room();
        await room.connect(WS_URL, token);
        log("âœ… Verbinding met LiveKit tot stand gebracht!", "ok");
      } catch (e) {
        log("âŒ Verbinding mislukt: " + e.message, "err");
      }
    };

    document.getElementById("startCam").onclick = async () => {
      log("ğŸ“¸ Cameratest gestart...");
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:false });
        const vid = document.getElementById("preview");
        vid.srcObject = stream;
        vid.style.display = "block";
        log("âœ… Camera actief!", "ok");
      } catch (e) {
        log("âŒ Cameratest mislukt: " + e.message, "err");
      }
    };
  </script>
</body>
</html>
