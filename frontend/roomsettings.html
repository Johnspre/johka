<div class="card" id="privateRoomSettings" style="margin-top:10px;padding:10px;background:#f8f8f8;border-radius:10px;">
  <h3>üîí Priv√©room Instellingen</h3>

  <label><input type="checkbox" id="isPrivateToggle"> Maak deze room priv√©</label>

  <div id="privateOptions" style="display:none;margin-top:10px;">
    <label>Toegangsmodus:</label>
    <select id="privateMode">
      <option value="invite">Invite-code</option>
      <option value="password">Wachtwoord</option>
      <option value="token">Tokens</option>
    </select>

    <div id="privateKeyField" style="margin-top:8px;">
      <label>Invite-code / wachtwoord:</label>
      <input id="privateKey" type="text" placeholder="geheim123">
    </div>

    <div id="privateTokenField" style="margin-top:8px;display:none;">
      <label>Prijs in tokens:</label>
      <input id="privateTokens" type="number" min="0" value="10">
    </div>

    <button id="createPrivateBtn" style="margin-top:10px;">Priv√©room aanmaken</button>
  </div>
</div>
<hr style="margin:15px 0;">

<button id="resetPublicBtn"
  style="background:#ff4d4f;color:white;border:0;border-radius:8px;
         padding:8px 12px;font-weight:600;cursor:pointer;">
  üîì Terug naar publieke room
</button>

<script>
(() => {
  const btn = document.getElementById("resetPublicBtn");
  if (!btn) return;

  btn.addEventListener("click", async () => {
    const slug = prompt("Naam of slug van de room die je publiek wilt maken:");
    if (!slug) return alert("Geen roomnaam opgegeven.");

    const token = localStorage.getItem("token");
    if (!token) return alert("Je bent niet ingelogd.");

    if (!confirm(`Weet je zeker dat je '${slug}' publiek wilt maken?`)) return;

    try {
      const res = await fetch("https://api.johka.be/api/room/update-access", {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          slug: slug,
          access_mode: "public"
        })
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.detail || res.statusText);
      alert("‚úÖ Room is nu publiek!");
    } catch (err) {
      console.error(err);
      alert("‚ùå Mislukt: " + err.message);
    }
  });
})();
</script>

<script>
(() => {
  const $ = (s) => document.querySelector(s);
  const toggle = $('#isPrivateToggle');
  const options = $('#privateOptions');
  const modeSel = $('#privateMode');
  const keyField = $('#privateKeyField');
  const tokenField = $('#privateTokenField');
  const btn = $('#createPrivateBtn');

  if (!toggle) return; // fragment nog niet goed geladen

  // uitklappen
  toggle.addEventListener('change', () => {
    options.style.display = toggle.checked ? 'block' : 'none';
  });

  // velden wisselen op basis van modus
  modeSel.addEventListener('change', () => {
    const m = modeSel.value;
    keyField.style.display   = (m === 'invite' || m === 'password') ? 'block' : 'none';
    tokenField.style.display = (m === 'token') ? 'block' : 'none';
  });

  // aanmaken
  btn.addEventListener('click', async () => {
    const name   = prompt('Naam van priv√©room:', 'mijn-room');
    if (!name) return;

    const mode   = modeSel.value;
    const key    = $('#privateKey')?.value || null;
    const tokens = Number($('#privateTokens')?.value || 0);

    const token = localStorage.getItem('token');
    if (!token) return alert('Je bent niet ingelogd.');

    try {
      const r = await fetch('https://api.johka.be/api/room/create-private', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, access_mode: mode, access_key: key, token_price: tokens })
      });
      const data = await r.json();
      if (!r.ok) throw new Error(data.detail || r.statusText);
      alert(`‚úÖ Priv√©room aangemaakt!\nSlug: ${data.slug}\nToegang: ${data.access_mode}`);
    } catch (e) {
      console.error(e);
      alert('‚ùå Mislukt: ' + e.message);
    }
  });
})();
</script>
